<div id="${this.name}Div" class="aclDynamicTable">
    <input type="hidden" name="${this.hiddenFieldName}" id="${this.hiddenFieldName}" value="" />
	<!-- beginning of grid table -->
    <table id="${this.name}Table" class="mgnl_dialog_grid data" cellpadding="2" cellspacing="0" border="0" width="100%">
    	<thead>
			<tr valign="bottom">
				<#list this.subs as col>
					<th>${this.getMessage(col.label)}</th>
				</#list>
				<td>${this.addButton}</td>
			</tr>
        </thead>
        <tbody class="grid_rows">
        </tbody>
        <tfoot>
			<#list this.subs as col>
				<th>${col.customJS!}</th>
			</#list>
        </tfoot>
	</table>
	<!-- end of grid table -->
</div>

<!--  used as a template for rendering the inner rows of the table-->
<textarea id="${this.name}InnerHtml" style="display: none; background-color: pink; width: 100%;">
    ${this.rowTemplateHTML}
</textarea>

<script type="text/javascript">
	var ${this.name}ColumnDefinitions = ${this.subsJSON};
	${this.columnAccessorMethods}
	
    function ${this.name}RenderObject(cell, prefix, index, obj) {
    	alert("renderObject - cell: " + cell);
    }

	// init the table	
	${this.name}DynamicTable = new MgnlDynamicTable(
		'${this.name}Table',				// tableName
		$('${this.hiddenFieldName}'),	// hiddenField
		${this.newObjectFunction},			// getNewObjectFunction
//		${this.getObjectFunction},			// getObjectFunction
		function(prefix, index) {
//			alert("getObjectFunction was called for prefix \"" + prefix + "\" and index "+index);
			return this.objects[index];
		},
		${this.name}RenderObject,			// renderObjectFunction
		null,								// validateFunction (null = no validation)
		${this.getJSON()}					// objects
	);
	
	// rewrite some functions
	${this.name}DynamicTable.render = function(update) {
		if(update==null){
			update = false;
		}
		
		if(update){
			this.objects = this.getObjects();
		}
	 
		// delte all
		var table = document.getElementById(this.tableName);
//		alert("table: "+table.id);
		// delete all rows bigger than row 0 (header row)
//		jQuery("tr:gt(0)", table).remove();
		jQuery("tbody.grid_rows>tr", table).remove();
		
		// append the template row for each object
		var currColName, currCellValue;
		var templateHtml = jQuery("#${this.name}InnerHtml").val();
//		alert("templateHtml for ${this.name}: "+templateHtml);

		for(i=0; i < this.objects.length; i++) {
			var object = this.objects[i];
			// copy the row template and add it to the table
			
			// replace the index stuff			
			jQuery("tbody.grid_rows", table).append(templateHtml.replace(/\$\{index\}/g, i));

			// get the newst row - the one we just created
			var row = jQuery("tbody.grid_rows>tr:last", table).get(0);
			// set the names, ids, and values
			var currColumnDef;
			for (j=0; j < ${this.name}ColumnDefinitions.length; j++) {
				currColumnDef = ${this.name}ColumnDefinitions[j];
				currColumnName = currColumnDef['nodeName'];
				var id = "#" + i + "_" + currColumnDef.name;
//				if ("${this.name}" == "boatClasses") {
//					alert("setting value in element with id "+id+" ("+jQuery(id) + ") to " + object[currColumnName]);
//					alert("row "+i+", col " +currColumnName + " = " + object[currColumnName]);
//					alert("setter function: "+currColumnDef.setValue);
					// 0_boatClasses_boatClassUUID -> '2763c229-23e3-4fbe-98a1-bc7698607c7a'
					// 0_boatClasses_boatClassUUID -> '2763c229-23e3-4fbe-98a1-bc7698607c7a'
//				}
				currColumnDef.setValue(i, object[currColumnName]);
			}
			// display the row
			jQuery(row).show();
		}
		jQuery("#${this.hiddenFieldName}").val(JSON.stringify(this.objects));
	}
	
	${this.name}DynamicTable.persist = function() {
		var str = "";
		this.objects = this.getObjects();
		
//		if(this.json){
		if (true) {
			// must include the json javascript
			str = JSON.stringify(this.objects);     
		}
		// old model
		else{
			// persist all
			for(i=0; i < this.objects.length; i++){
				if(i >0)
					str += ";";
				str += this.persistObject(this.objects[i]) ;
			}
		}
//		alert("persisted string: "+str);
//		alert("hidden field: "+ this.hiddenField);
		this.hiddenField.value = str;
	}
	
	${this.name}DynamicTable.getObjects = function() {
		var objects = new Array();
		var currObject;
		// get table
		var table = document.getElementById(this.tableName);
		var dataRowCount = jQuery("tbody.grid_rows>tr", table).size(); 
//		alert("row count: "+dataRowCount + ", col count: " + ${this.name}ColumnDefinitions.length);
		for (i=0; i<dataRowCount; i++) {
			currObject = new Object();
			for (j=0; j < ${this.name}ColumnDefinitions.length; j++) {
				currColumnDef = ${this.name}ColumnDefinitions[j];
				currColumnName = currColumnDef['nodeName'];
				var id = "#" + i + "_" + currColumnDef.name;
				currObject[currColumnName] = currColumnDef.getValue(i);
			}
			objects.push(currObject);
		}		
		return objects;
	}
	
	${this.name}DynamicTable.render();
	if ("${this.name}" == "boatClasses") {
//		${this.name}DynamicTable.persist();
//		alert(jQuery("#0_boatClasses_boatClassUUID").val());
//		alert("boat class 0: " + ${this.name}ColumnDefinitions[0].getValue(0));
	}
	
//	if ("${this.name}" == "jury") {
//		alert(typeof juryColumnDefinitions[0].test);
//		juryColumnDefinitions[0].test2 = eval(juryColumnDefinitions[0].test);
//		alert(typeof juryColumnDefinitions[0].test2);
//		juryColumnDefinitions.test("freak", "you");
//		alert(${this.name}ColumnDefinitions);
//		jQuery("#0_boatClasses_boatClassUUID").val('8728e168-e389-44b0-911f-5f9c67d5c814');
//boatClassesColumnDefinitions[0].setValue(0, "9d032b24-3f8f-438b-a444-3e99abdc64c3");
//	}
			
</script>
${this.saveInfo}

